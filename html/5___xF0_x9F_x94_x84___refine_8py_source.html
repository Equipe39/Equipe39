<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PolyBM: pages/5_ðŸ”„_Refine.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="LGS.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">PolyBM<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">The PolyBM Data Analysis Tool is an AI tool that helps users profile, format, and anonymize data from CSV, JSON, and XML files. The tool offers various functionalities such as creating charts, generating data quality reports, and anonymizing sensitive data.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_208d2690607c4e3d3fabfa1d18673d36.html">pages</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">5_ðŸ”„_Refine.py</div></div>
</div><!--header-->
<div class="contents">
<a href="5___xF0_x9F_x94_x84___refine_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html">    1</a></span><span class="comment"># This is the heart of the code. We need to careful about the order of the arguments so that we don&#39;t have to worry about them</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">import</span> streamlit <span class="keyword">as</span> st</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">from</span> src.formatting <span class="keyword">import</span> Formatter</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">from</span> st_aggrid <span class="keyword">import</span> AgGrid, GridOptionsBuilder</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="keyword">from</span> src.constants <span class="keyword">import</span> FORMAT_TYPES</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="keyword">import</span> src.JPI</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span> </div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span> </div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"># Refine page layout</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#ac7016545e737139871bd7b444309e6f3">   16</a></span>st.set_page_config(layout=<span class="stringliteral">&quot;wide&quot;</span>)</div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>st.title(<span class="stringliteral">&quot;Refining&quot;</span>)</div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="keywordflow">if</span> <span class="stringliteral">&#39;df_format&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> st.session_state:</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>    st.warning(<span class="stringliteral">&#39;Please go back to the Upload page and select the data.&#39;</span>)</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a079d3535362a2ab5b8a33d7c1ce138fc">   21</a></span><span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>    <span class="comment"># Column formatting</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a6b69656908e3a9b5fdab64643133ecbe">   23</a></span>    df = st.session_state[<span class="stringliteral">&#39;df_format&#39;</span>]</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a771874180aea39e71e13f3c4b3b8a292">   24</a></span>    col_a, col_b = st.columns(2)</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>    <span class="keyword">with</span> col_a:</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#aea8500dc2d65c477b6f3ef52d1f7cc98">   26</a></span>        <span class="keyword">with</span> st.form(key=<span class="stringliteral">&quot;form_format&quot;</span>):</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#ac159d7ac21f779b7c7cf66d7b0e1dca3">   27</a></span>            col_to_format = st.selectbox(<span class="stringliteral">&quot;Column to format&quot;</span>, df.columns)</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#ab3ffda2a1e175068dba55cc8db26d5f3">   28</a></span>            format_type = st.selectbox(<span class="stringliteral">&quot;Format type&quot;</span>, FORMAT_TYPES)</div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a7bd4e309d7e7e855dbc65df97d9a26b4">   29</a></span>            submit_format = st.form_submit_button(label=<span class="stringliteral">&#39;Format&#39;</span>)</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>        </div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>    <span class="keywordflow">if</span> submit_format:</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#ab84d730cbcee83c804f39c728d54562b">   34</a></span>        <span class="keywordflow">try</span>:</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>            st.session_state[<span class="stringliteral">&#39;df_format&#39;</span>][col_to_format] = st.session_state[<span class="stringliteral">&#39;df&#39;</span>][col_to_format].copy()</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a434b1d09bfa1f7f841dab4ce1a282cbd">   36</a></span>            f = Formatter()</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>            f.apply_format(format_type, col_to_format)</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>            st.session_state[<span class="stringliteral">&#39;df_format&#39;</span>][col_to_format] = st.session_state[<span class="stringliteral">&#39;df_format&#39;</span>][col_to_format].replace(np.nan,</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>                                                                                                                <span class="stringliteral">&quot;null&quot;</span>).copy()</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>        <span class="keywordflow">except</span> AttributeError:</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>            st.error(<span class="stringliteral">&#39;Cannot format this column : invalid data type&#39;</span>)</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>        <span class="keywordflow">except</span> TypeError:</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>            st.error(<span class="stringliteral">&#39;Cannot format this column : invalid data type&#39;</span>)</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <span class="comment"># Reset column</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <span class="keyword">with</span> col_b:</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span> </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        <span class="keyword">with</span> st.form(key=<span class="stringliteral">&quot;type_id&quot;</span>):</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#afbc9dc56fc9610f0154a4820fcf8538f">   49</a></span>            sample_size_input = st.number_input(<span class="stringliteral">&#39;sample size&#39;</span>, min_value=0.05, max_value=1.0, step=0.05, value=src.JPI.DEFAULT_SAMPLE_SIZE)</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#aac4bde8063d8f48592b92b0fbade9f5b">   50</a></span>            submit_identify_type = st.form_submit_button(label=<span class="stringliteral">&#39;Identify data types&#39;</span>)</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>        <span class="keyword">with</span> st.form(key=<span class="stringliteral">&quot;form_reset&quot;</span>):</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a1b84dca739defdd720099b837464d0c4">   53</a></span>            col_to_reset = st.selectbox(<span class="stringliteral">&quot;Column to reset&quot;</span>, df.columns)</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a0bffdf9b16730349bcd045feff60c664">   54</a></span>            submit_reset = st.form_submit_button(label=<span class="stringliteral">&#39;Reset column&#39;</span>)</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span> </div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <span class="keywordflow">if</span> submit_reset:</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>        st.session_state[<span class="stringliteral">&#39;df_format&#39;</span>][col_to_reset] = st.session_state[<span class="stringliteral">&#39;df&#39;</span>][col_to_reset].copy()</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <span class="keywordflow">if</span> submit_identify_type:</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>        </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <span class="keyword">with</span> src.JPI.JPI() <span class="keyword">as</span> jpi:</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>            st.session_state[<span class="stringliteral">&#39;df_format&#39;</span>] = st.session_state[<span class="stringliteral">&#39;df&#39;</span>].copy()</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>            jpi.identify_type(st.session_state[<span class="stringliteral">&#39;df_format&#39;</span>],sample_size_input)</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a6f87527891f0f47aa97ddf6657b9ea5f">   64</a></span>            types = pd.DataFrame({<span class="stringliteral">&#39;Column&#39;</span>: st.session_state[<span class="stringliteral">&#39;df_format&#39;</span>].columns, <span class="stringliteral">&#39;Type&#39;</span>: jpi.data_types})</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>            st.dataframe(types.T)</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>            </div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="comment"># Create dataframe grid</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#aa50c375938a1807310983f033696612d">   69</a></span>    gb = GridOptionsBuilder.from_dataframe(df)</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#ab27cace1f974896bdbc7330b4b3a3c3c">   70</a></span>    gb.configure_pagination(paginationAutoPageSize=<span class="keyword">True</span>)  <span class="comment"># Add pagination</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    gb.configure_side_bar()  <span class="comment"># Add a sidebar</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a9f948e33a0a8b9d87bd8a6e8daea555a">   72</a></span>    gb.configure_selection(<span class="stringliteral">&#39;multiple&#39;</span>, use_checkbox=<span class="keyword">True</span>,</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#ae2ac97c5e28efeaa0d7d9216f9f83628">   73</a></span>                           groupSelectsChildren=<span class="stringliteral">&quot;Group checkbox select children&quot;</span>)  <span class="comment"># Enable multi-row selection</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a3ad8e6a1f7879a5e32da40b0ba1ca665">   74</a></span>    gridOptions = gb.build()</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a0cef2d6e98efb8e89d9184f460e3b31d">   76</a></span>    grid_response = AgGrid(</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>        df,</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        gridOptions=gridOptions,</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>        data_return_mode=<span class="stringliteral">&#39;AS_INPUT&#39;</span>,</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>        update_mode=<span class="stringliteral">&#39;MODEL_CHANGED&#39;</span>,</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>        fit_columns_on_grid_load=<span class="keyword">False</span>,</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>        theme=<span class="stringliteral">&#39;alpine&#39;</span>,  <span class="comment"># Add theme color to the table</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        enable_enterprise_modules=<span class="keyword">True</span>,</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        height=600,</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>        width=<span class="stringliteral">&#39;100%&#39;</span>,</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>        reload_data=<span class="keyword">True</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    )</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span> </div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a10d747028683aafbcc283602deeab7c8">   89</a></span>    inter_cols_pace, col2 = st.columns((11, 1))</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="keyword">with</span> col2:</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno"><a class="line" href="namespace5___xF0_x9F_x94_x84___refine.html#a7a2ee4d6a555b1bb0b9dc5af5539456e">   91</a></span>        submit_reset_all = st.button(label=<span class="stringliteral">&#39;Reset dataset&#39;</span>)</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="keywordflow">if</span> submit_reset_all:</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>        st.session_state[<span class="stringliteral">&#39;df_format&#39;</span>] = st.session_state[<span class="stringliteral">&#39;df&#39;</span>].copy()</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>        st.experimental_rerun()</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>

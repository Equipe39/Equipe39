<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PolyBM: HL7 masking</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="LGS.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">PolyBM<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">The PolyBM Data Analysis Tool is an AI tool that helps users profile, format, and anonymize data from CSV, JSON, and XML files. The tool offers various functionalities such as creating charts, generating data quality reports, and anonymizing sensitive data.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">HL7 masking </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example shows how to mask a value in the HL7 object model. Let's assume that the de-identification rule says that we need to hash the <code>/.MSH-3-1</code> element of a v2.3 HL7 object.</p>
<p>The notation of the element paths is based on the xref path defined here: <a href="https://hapifhir.github.io/hapi-hl7v2/base/apidocs/ca/uhn/hl7v2/util/Terser.html">Terser documentation</a></p>
<p>In the <code>toBeMasked</code> field, we create an entry with the key being the element path and the value being the masking provider we want to use for this elemement.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  </div>
<div class="line">  &quot;toBeMasked&quot; : {</div>
<div class="line">    &quot;/.MSH-3-1&quot;: &quot;HASH&quot;</div>
<div class="line">  },</div>
<div class="line"> </div>
<div class="line">  &quot;inputFormat&quot;: &quot;HL7&quot;,</div>
<div class="line">  &quot;outputFormat&quot;: &quot;HL7&quot;,    </div>
<div class="line">    </div>
<div class="line">  &quot;_fields&quot;: {</div>
<div class="line">  },</div>
<div class="line">  &quot;_defaults&quot;: {</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md63"></a>
Example of per-field configuration</h1>
<p>According to the documentation, the default hash algorithm is SHA-256. If we want to change the behavior, let's say we want to use SHA-512, we can override the per-field configuration:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  </div>
<div class="line">  &quot;toBeMasked&quot; : {</div>
<div class="line">    &quot;/.MSH-3-1&quot;: &quot;HASH&quot;</div>
<div class="line">  },</div>
<div class="line"> </div>
<div class="line">  &quot;inputFormat&quot;: &quot;HL7&quot;,</div>
<div class="line">  &quot;outputFormat&quot;: &quot;HL7&quot;,    </div>
<div class="line">    </div>
<div class="line">  &quot;_fields&quot;: {</div>
<div class="line">        &quot;/.MSH-3-1&quot; : {</div>
<div class="line">            &quot;hashing.algorithm.default&quot;: &quot;SHA-512&quot;</div>
<div class="line">        }</div>
<div class="line">  },</div>
<div class="line">  &quot;_defaults&quot;: {</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md64"></a>
Masking through the API</h1>
<p>The HL7 record masking is being performed through the FormatProcessor object. Initially, we need to get the processor for HL7 messages:</p>
<div class="fragment"><div class="line">FormatProcessor formatProcessor = FormatProcessorFactory.getProcessor(DataTypeFormat.HL7);</div>
</div><!-- fragment --><p>Once we get the processor, we can invoke the maskStream method to get the deidentified record back:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> maskStream(InputStream dataset, PrintStream output,</div>
<div class="line">                    ConfigurationManager configurationManager,</div>
<div class="line">                    DataMaskingOptions dataMaskingOptions, Set&lt;String&gt; alreadyMaskedFields,</div>
<div class="line">                    Map&lt;ProviderType, Class&lt;? extends MaskingProvider&gt;&gt; registerTypes) <span class="keywordflow">throws</span> IOException;</div>
</div><!-- fragment --><p>The <code>ConfigurationManager</code> and <code>DataMaskingOptions</code> are instantiated based on the configuration contents, as described in the previous sections. The <code>dataset</code> parameter is the input stream to the record and the <code>output</code> is the print stream where the deidentified record will be printed. The <code>alreadyMaskedFields</code> parameter defines a list of fields that have been already masked externally and thus the processor will skip them. The <code>registerTypes</code> defines user-defined masking providers.</p>
<p>A test example to de-identify a HL7 record using <code>hl7v23lookup.json</code> as a configuration file is shown below:</p>
<div class="fragment"><div class="line">@Test</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> testHL7v23LookupTokens() throws Exception {</div>
<div class="line"> </div>
<div class="line">        String msg = <span class="stringliteral">&quot;MSH|^~\\&amp;|ULTRA|TML|OLIS|OLIS|200905011130||ORU^R01|20169838-v23|T|2.3\r&quot;</span></div>
<div class="line">                + <span class="stringliteral">&quot;PID|||7005728^^^TML^MR||RACHEL^DIAMOND||19310313|F|||200 ANYWHERE ST^^TORONTO^ON^M6G 2T9||(416)888-8888||||||1014071185^KR\r&quot;</span></div>
<div class="line">                + <span class="stringliteral">&quot;PV1|1||OLIS||||OLIST^BLAKE^DONALD^THOR^^^^^921379^^^^OLIST\r&quot;</span></div>
<div class="line">                + <span class="stringliteral">&quot;ORC|RE||T09-100442-RET-0^^OLIS_Site_ID^ISO|||||||||OLIST^BLAKE^DONALD^THOR^^^^L^921379\r&quot;</span></div>
<div class="line">                + <span class="stringliteral">&quot;OBR|0||T09-100442-RET-0^^OLIS_Site_ID^ISO|RET^RETICULOCYTE COUNT^HL79901 literal|||200905011106|||||||200905011106||OLIST^BLAKE^DONALD^THOR^^^^L^921379||7870279|7870279|T09-100442|MOHLTC|200905011130||B7|F||1^^^200905011106^^R\r&quot;</span></div>
<div class="line">                + <span class="stringliteral">&quot;OBX|1|ST|||Test Value for Rachel Diamond&quot;</span>;</div>
<div class="line"> </div>
<div class="line">        InputStream inputStream = <span class="keyword">new</span> ByteArrayInputStream(msg.getBytes());</div>
<div class="line"> </div>
<div class="line">        ByteArrayOutputStream outputStream = <span class="keyword">new</span> ByteArrayOutputStream();</div>
<div class="line">        PrintStream printStream = <span class="keyword">new</span> PrintStream(outputStream);</div>
<div class="line"> </div>
<div class="line">        ConfigurationManager configurationManager = ConfigurationManager.load(this.getClass().getResourceAsStream(<span class="stringliteral">&quot;/hl7v23lookup.json&quot;</span>));</div>
<div class="line">        JsonNode maskingOptions = (<span class="keyword">new</span> ObjectMapper()).readTree(this.getClass().getResourceAsStream(<span class="stringliteral">&quot;/hl7v23lookup.json&quot;</span>));</div>
<div class="line"> </div>
<div class="line">        FormatProcessor formatProcessor = FormatProcessorFactory.getProcessor(DataTypeFormat.HL7);</div>
<div class="line">        formatProcessor.maskStream(inputStream, printStream, configurationManager, <span class="keyword">new</span> DataMaskingOptions(maskingOptions), <span class="keyword">new</span> HashSet&lt;&gt;(), <span class="keyword">null</span>);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
